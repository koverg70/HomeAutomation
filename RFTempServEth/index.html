<html>
<head>
<script type="text/javascript">
function load()
{
    var html = "";
    html = html + "<table border='1'>";
    for (i = 0; i < 3; ++i)
    {
        html = html + "<tr>";
	 	for (j = 0; j < 8; ++j)
	 	{
            html = html + "<td align='center'>";
            hour = i * 8 + j;
            html = html + hour;
            html = html + "</td>";
        }
        html = html + "</tr>";
        html = html + "<tr>";
		for (j = 0; j < 8; ++j)
		{
	         html = html + "<td>";
		     for (k = 0; k < 4; ++k)
		     {
		         index = i * 32 + j * 4 + k;
		 	 	 html = html + '<input onclick="sendSettings()" type="checkbox" name="option' + index + '" value="" id="check' + index + '">';
		     }
	         html = html + "</td>";
		}
        html = html + "</tr>";
    }
    html = html + "<table>";
 
    document.getElementById("checkTable").innerHTML = html;

    // loadXMLDoc();

	setInterval(function(){
	   window.loadXMLDoc();
	   //window.location.reload(1);
	}, 2000);

}

function loadXMLDoc()
{
    var xmlhttp;
    if (window.XMLHttpRequest)
    {
	 	// code for IE7+, Firefox, Chrome, Opera, Safari
	 	xmlhttp=new XMLHttpRequest();
    }
    else
    {
        // code for IE6, IE5
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange=function()
        {
            if (xmlhttp.readyState==4 && xmlhttp.status==200)
            {
                var response = eval("(" + xmlhttp.responseText + ")");
                document.getElementById("clock").innerHTML=response.time;
                document.getElementById("start").innerHTML=response.start;
                document.getElementById("lastSensorData").innerHTML=response.lastSensorData;
                document.getElementById("longestSensorWait").innerHTML=response.longestSensorWait;
                document.getElementById("tempDHT11").innerHTML=response.tempDHT11;
                document.getElementById("humidityDHT11").innerHTML=response.humidityDHT11;
                document.getElementById("tempDS18B20").innerHTML=parseFloat(response.tempDS18B20)/100;
	        	var st = response.settings;
                for (i = 0; i < 96; ++i)
                {
                    if (st.charAt(i) == '1')
                    {
                        document.getElementById("check"+i).checked = true;
                    }
                    else
                    {
                        document.getElementById("check"+i).checked = false;
                    }
	        }
            }
       }
    xmlhttp.open("GET", "http://192.168.1.44/", true);
    xmlhttp.send();
}

function sendSettings()
{
    var st = "";
    for (i = 0; i < 96; ++i)
    {
        st = st + (document.getElementById("check"+i).checked ? "1" : "0");
    }
    //window.alert(st);
    var xmlhttp;

    if (window.XMLHttpRequest)
    {
	 // code for IE7+, Firefox, Chrome, Opera, Safari
	 xmlhttp=new XMLHttpRequest();
    }
    else
    {
        // code for IE6, IE5
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.open("GET","http://192.168.1.44/S-"+st,true);
    xmlhttp.onreadystatechange=function()
        {
            //window.alert("ready=" + xmlhttp.readyState + "; status=" + xmlhttp.status);
       }
    xmlhttp.send();
}
</script>
</head>
<body onload="load()">

<h2>AVR vezérlõ</h2>
<p>Pontos idõ a vezérlõn: <span id="clock">?</span></p>
<div id="checkTable"><p>Here comes the checkbox list</p></div>
<button type="button" onclick="loadXMLDoc()">Refresh</button>
<button type="button" onclick="sendSettings()">Send</button>

<p font="-2">Vezérlõ indítási ideje: <span id="start">?</span></p>
<p font="-2">Utolsó észlelési idõ: <span id="lastSensorData">?</span></p>
<p font="-2">Leghosszabb szenzor várakozás: <span id="longestSensorWait">?</span></p>
<p font="-2">DHT11 hõmérséklet: <span id="tempDHT11">?</span>°C</p>
<p font="-2">DHT11 páratartalom: <span id="humidityDHT11">?</span>%</p>
<p font="-2">DS18B20 hõmérséklet: <span id="tempDS18B20">?</span>°C</p>

</body>
</html>